<!DOCTYPE html>
<html lang="ko" dir="ltr">

<head>
  <link rel="shortcut icon" href="#">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta http-equiv="content-type" charset="utf-8">
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script src="https://www.gstatic.com/firebasejs/7.22.1/firebase-app.js"></script>

  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.2/css/bootstrap.min.css">
  <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.2/js/bootstrap.min.js"></script>
  <link rel="stylesheet" href="../css/Munjin_style.css">
  </style>
  <title>Login</title>
</head>

<body>
  <!-- Header -->
  <div id="header">로그인</div>

  <!-- Container -->
  <div class="container">
    <input class="form-control" id="user_id" type="text" name="ID" placeholder="ID">
    <input class="form-control" id="user_pw" type="password" name="PW" placeholder="Password">
    <input id="check_save" type="checkbox" name="check_save"><label for="check_save">로그인 정보 저장</label>

    <div>
      <button class="btn btn-default login" type="submit" name="login" id="btn_login">로그인</button>
      <button class="btn btn-default join" type="button" name="sign_up" id="btn_signUp" onClick="location.href='./Munjin_0_join.html'">회원가입</button>
    </div>
  </div>

  <script src="https://www.gstatic.com/firebasejs/7.22.1/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/6.2.0/firebase.js"></script>

  <script>
    var firebaseEmailAuth;
    var firebaseDatabase;
    var userInfo;
    // Your web app's Firebase configuration
    var firebaseConfig = {
      apiKey: "AIzaSyBWCGyjxtDL7smhVRkraxI-6EDGZuIGPvE",
      authDomain: "munjinmunjin-75fc5.firebaseapp.com",
      databaseURL: "https://munjinmunjin-75fc5.firebaseio.com",
      projectId: "munjinmunjin-75fc5",
      storageBucket: "munjinmunjin-75fc5.appspot.com",
      messagingSenderId: "452765368961",
      appId: "1:452765368961:web:8e7510b77ff4e7c8b18380"
    };
    firebase.initializeApp(firebaseConfig);
    
    firebaseEmailAuth = firebase.auth();
    firebaseDatabase = firebase.database();

    $(document).ready(function () {

      //가입버튼 눌렀을 때
      $(document).on('click', '.login', function () {

        //제이쿼리 선택자와 val() 함수를 이용해서 이메일,비밀번호 값을 가져온다. 
        var id = $('#user_id').val();
        var password = $('#user_pw').val();
        alert("로그인 버튼 눌렸음" + id + ":" + password);

        //파이어베이스 이메일 로그인 함수
        firebaseEmailAuth.signInWithEmailAndPassword(id, password)
          .then(function (firebaseUser) {

            //성공하면 firebaseUser에 유저 정보 값이 담겨 넘어온다.
            loginSuccess(firebaseUser);

          })
          .catch(function (error) {
            // 실패했을 때 에러 처리
            alert(error);
            alert("로그인 실패");
          });

      });
    });

    //로그인 성공했을 때
    function loginSuccess(firebaseUser) {
      alert("로그인 성공");
      //로그인 성공한 유저 id 확인해 보기 - firebase database에 접근해서 데이터 조회 하는 함수
      firebaseDatabase.ref("users/" + firebaseUser.uid).once('value').then(function (snapshot) {
        //alert(snapshot.val().name)
      });

      //메인 페이지로 이동
      window.location.href = "/Munjin_1_main.html"
    }
  </script>
</body>

</html>